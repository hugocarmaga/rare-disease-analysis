# Rare Disease SV filtering pipeline

This pipeline is meant to filter and get some statistics on rare disease samples' SVs after comparing them with big SV resources, such as [SAGA] and [HGSVC3].
It builds on results from this [callset comparison pipeline].

## System Requirements

- python=3.9.12
- snakemake=7.32.4
- conda=24.1.2

## Installation Guide

### Instructions

The pipeline is run with snakemake and the dependencies of each rule is resolved by the specified conda environment.

## Instructions for use

### Input

As mentioned above, this pipeline requires results from another [callset comparison pipeline] as input, namely the intersection tables generated by that pipeline and saved in `results/intersection/intersection_all.tsv` in it. There, it's assumed that an intersection was done between at least two VCF files, following a certain order:
- First, any given number of SV VCFs belonging to a rare disease sample, and for which we'll get exclusive variants with this pipeline
- Then, SAGA's VCF before genotyping (`giggles-panel-biallelic.vcf.gz`) after them
- Additionally, more VCF files with other SV resources can be added to the comparison. They should all be after SAGA's VCF.

This order is crucial for the analysis done here. The number of compared SV callsets should be given in the `config/config.yaml` in the form of a list of two integers provided to the `callsets` variable. The example included is for the analysis done in the context of [SAGA]'s paper, where we have 2 VCF files from rare disease patients, SAGA's VCF and additionaly the [HGSVC3]'s SV VCF, in that order. So, we give the list `callsets: [2,4]`, where `2` is the number of VCFs from the rare disease patient, and `4` the total number of VCFs. SAGA's VCF is always assumed to be right after the rare disease patients'.

The VCF files added first in the comparison pipeline, should also be provided, together with the mentioned intersection tables. These will be used to generate new VCFs with variants exclusive to the rare disease patients.

A reference genome to extract alleles in FASTA format is also required, as well as a graph to realign these alleles to. In this case, we suggest using [SAGA]'s augmented graph.

### Output

The main outputs of the pipeline are:
- A VCF file per given sample including only SVs exclusive to the rare disease patients (i.e., not found in any of the other SV resources)
- Allele Frequency (log-scale) distribution plots of the variants intersecting:
- - both rare disease patients' VCFs and SAGA's, but not any of the other resources
- - both rare disease patients' VCFs and SAGA's, as well as one of the other resources
- A VCF file containing SVs found in both rare disease patients' VCFs and another resource, but not in SAGA
- GAF files with alignments of variants found in both rare disease patients' VCFs and another resource, but not in SAGA
- Sequence Identity distribution plots for the unique and whole length alignments from above

### How to run

First, set the `config/config.yaml` according to the instructions above.

Then, under the directory `rare-disease-analysis`:
```
$ snakemake -j <cores> --use-conda
```

[SAGA]: https://doi.org/10.1101/2024.04.18.590093
[HGSVC3]: https://doi.org/10.1101/2024.09.24.614721
[callset comparison pipeline]: https://github.com/eblerjana/callset-comparison